<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
</head>
<body>
    <canvas id="canvas" width="1600px" height="900px" style="border: 1px solid black;"></canvas>
    <button onclick="changeFrame(1)">Next</button>
    <button onclick="changeFrame(-1)">Prev</button>
</body>
</html>

<script>
    const canvas = document.getElementById("canvas");
    const ctx = canvas.getContext('2d');
    const drawJSON = {
        "frame" : 1,
        "imageName": "spritesheet.png", // TODO
        "tint": "RGB", // TODO
        "rotateInDegrees": 0,
        "positionX" : 300,
        "positionY" : 300,
        "widthInCanvas" : 500,
        "heightInCanvas" : 500,
        "keepDimensionsToWidth" : true,
        "keepDimensionsToHeight" : true,
        "layer": 1, // TODO
        // first element - base width and height of frame, then x, y for every frame 
        "imageMappingJSON": [
            {
                frameWidth: 172,
                frameHeight: 183,
            },
            {
                x: 0 * 172,
                y: 0 * 183,
            },
            {
                x: 1 * 172,
                y: 0 * 183,
            },
            {
                x: 2 * 172,
                y: 0 * 183,
            },
            {
                x: 3 * 172,
                y: 0 * 183,
            },
            {
                x: 4 * 172,
                y: 0 * 183,
            },
            {
                x: 0 * 172,
                y: 1 * 183,
            },
            {
                x: 1 * 172,
                y: 1 * 183,
            },
            {
                x: 2 * 172,
                y: 1 * 183,
            },
            {
                x: 3 * 172,
                y: 1 * 183,
            },
            {
                x: 4 * 172,
                y: 1 * 183,
            }
        ]
    }
    let img = new Image();
    img.src = './static/spritesheet.png';
    img.onload = () => {
        drawImageByFrame(img, drawJSON)
    }
    
    function drawImageByFrame(img, drawJSON) {
        let widthInCanvas = drawJSON.widthInCanvas;
        let heightInCanvas = drawJSON.heightInCanvas;
        if (drawJSON.keepDimensionsToWidth) {
            widthInCanvas = drawJSON.imageMappingJSON[0].frameWidth;
        }
        if (drawJSON.keepDimensionsToHeight) {
            heightInCanvas = drawJSON.imageMappingJSON[0].frameHeight;
        }

        ctx.save();
        // use translate for positioning
        ctx.translate(drawJSON.positionX, drawJSON.positionY);
        // translate for rotation and rotation itself
        ctx.translate(drawJSON.imageMappingJSON[0].frameWidth/2, drawJSON.imageMappingJSON[0].frameHeight/2);
        ctx.rotate(drawJSON.rotateInDegrees * Math.PI / 180);
        // drawImage by frame
        ctx.drawImage(img, drawJSON.imageMappingJSON[drawJSON.frame].x, drawJSON.imageMappingJSON[drawJSON.frame].y, drawJSON.imageMappingJSON[0].frameWidth, drawJSON.imageMappingJSON[0].frameHeight, -drawJSON.imageMappingJSON[0].frameWidth/2, -drawJSON.imageMappingJSON[0].frameHeight/2, widthInCanvas, heightInCanvas);
        
        ctx.restore();
    }

    // Used for testing purposes
    function changeFrame(number) {
        frame = frame + number;
        if (frame === 0) {
            frame = 10;
        } else if (frame === 11) {
            frame = 1;
        }
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        ctx.drawImage(img, drawJSON.imageMappingJSON[frame].x, drawJSON.imageMappingJSON[frame].y, drawJSON.imageMappingJSON[0].frameWidth, drawJSON.imageMappingJSON[0].frameHeight, 150, 100, drawJSON.imageMappingJSON[0].frameWidth, drawJSON.imageMappingJSON[0].frameHeight);
    }
    </script>